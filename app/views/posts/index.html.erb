<div id="map">
  
</div>

<% if admin_signed_in? %>
  <%= link_to 'New Post', new_post_path, class: "btn btn-primary pull-right" %>
<% end %>
<% @posts.each do |post| %>
  <% if post.published || post.published == nil %>
    <div class="posts">
      <div class="row">
        <div class="span8">
          <h2><%= link_to post.title, post %></h2>
          <pre>Posted at <%= post.created_at %><span class="pull-right">Share:</span></pre>
          <%= raw post.content %>
          <% if post.tag_list.count > 0 %>
            <p>Tags:
            <% post.tag_list.each do |tag| %>
              <span class="label label-info"><%= link_to tag, tag_path(tag), style: "color:white;"%></span>
            <% end %>
            </p>
          <% end %>
          <% if post.comments.count > 0 %>
            <%= link_to pluralize(post.comments.count, " comment") + " so far.", "/posts/"+post.id.to_s+"#comments", class: "links" %>
          <% else %>
            <%= link_to "Leave a Comment", "/posts/"+post.id.to_s+"#add-comment", class: "links" %>
          <% end %>
          <br>
          <% if admin_signed_in? %>
            <span class="admin">
              <%= link_to 'Edit', edit_post_path(post) %> | 
              <%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } %>
            </span>
          <% end %>
          <br>
          
        </div>
      </div>
      <div class="span4"></div>
    </div>
  <% end %>
<% end %>



<script type="text/javascript">
  $(document).ready(function(){ 

  var mapmaker = L.map('map').setView([51.505, 7], 5); 
  //http://maps.cloudmade.com/?styleId=114841
  
   // var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/{key}/22677/256/{z}/{x}/{y}.png',  
   // cloudmadeAttribution = 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 FirstFuel',  
   // cloudmade = new L.TileLayer(cloudmadeUrl, {maxZoom: 18, attribution: cloudmadeAttribution, key: 'xxxxxxxxxxxx'  
   // }),  
   // latlng = new L.LatLng(<%= raw @lat.to_json %>,<%= raw @lng.to_json %>);  
   // fsMap = new L.Map('map', {center: latlng, zoom:15, zoomControl:false, layers: [cloudmade], scrollWheelZoom : false});     
  L.tileLayer('http://{s}.tile.cloudmade.com/5e9427487a6142f7934b07d07a967ba3/114841/256/{z}/{x}/{y}.png', {
      attribution: 'EuroHackTrip',
      maxZoom: 18
  }).addTo(mapmaker);

  // var marker = L.marker([51.5, -0.09]).addTo(mapmaker);


    //marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
  var myIcon = L.icon({
    iconUrl: '/assets/leaflet_label/images/death.png',
    iconSize: [20, 20],
    iconAnchor: [10, 10],
    labelAnchor: [6, 0] // as I want the label to appear 2px past the icon (10 + 2 - 6)
  });

  L.marker([51.72703, -0.04395], {
    icon: myIcon
  })
  .bindLabel("London", {
    noHide: true,
    direction: 'auto'
  }).addTo(mapmaker); 
 
  L.marker([48.89362, 2.37305], {
    icon: myIcon
  })
  .bindLabel("Paris", {
    noHide: true,
    direction: 'auto'
  }).addTo(mapmaker); 
 
  L.marker([50.76426, 4.79004], {
    icon: myIcon
  })
  .bindLabel("Brussels", {
    noHide: true,
    direction: 'auto'
  }).addTo(mapmaker);
 
  L.marker([52.32191, 5.18555], {
    icon: myIcon
  })
  .bindLabel("Amsterdam", {
    noHide: true,
    direction: 'auto'
  }).addTo(mapmaker); 
 
  L.marker([52.45601, 13.27148], {
    icon: myIcon
  })
  .bindLabel("Berlin", {
    noHide: true,
    direction: 'auto'
  }).addTo(mapmaker); 
 
  L.marker([46.98025, 7.60254], {
    icon: myIcon
  })
  .bindLabel("Zurich", {
    noHide: true,
      direction: 'auto'
  }).addTo(mapmaker); 
   

    // var popup = L.popup();//initialize a leaflet popup and assign it to a variable
    // function onMapClick(e) {
    //     popup
    //         .setLatLng(e.latlng)
    //         .setContent("You clicked the mapmaker at " + e.latlng.toString())
    //         .openOn(mapmaker);//activate the 'popup'
    // };
    // mapmaker.on('click', onMapClick);


 });  
</script>

